<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>852camera ç§Ÿå€Ÿè¨ˆç®—å™¨</title>
  <style>
    :root {
      --primary-color: #2563eb;
      --primary-hover: #1d4ed8;
      --bg-color: #f3f4f6;
      --card-bg: #ffffff;
      --text-main: #1f2937;
      --text-muted: #6b7280;
      --border-color: #e5e7eb;
      --success-color: #10b981;
      --success-hover: #059669;
      --whatsapp-color: #25D366;
      --whatsapp-hover: #128C7E;
      --danger-color: #ef4444;
      --radius: 16px;
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --transition: all 0.2s ease;
    }

    /* Dark Mode Variables */
    [data-theme="dark"] {
      --bg-color: #111827;
      --card-bg: #1f2937;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-color: #374151;
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 20px 20px 80px 20px; /* Extra padding bottom for sticky bar */
      background-color: var(--bg-color);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .container {
      width: 100%;
      max-width: 550px;
      background: var(--card-bg);
      padding: 30px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-top: 20px;
      position: relative;
      transition: background-color 0.3s ease;
    }

    /* Theme Toggle */
    .theme-toggle {
      position: absolute;
      top: 25px;
      right: 25px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 20px;
      color: var(--text-muted);
      padding: 5px;
      border-radius: 50%;
      width: auto;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .theme-toggle:hover {
      background-color: rgba(0,0,0,0.05);
      color: var(--primary-color);
    }
    [data-theme="dark"] .theme-toggle:hover {
      background-color: rgba(255,255,255,0.1);
    }

    /* Reset Button */
    .reset-btn {
      position: absolute;
      top: 25px;
      left: 25px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      color: var(--text-muted);
      padding: 5px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .reset-btn:hover {
      color: var(--danger-color);
      text-decoration: underline;
    }

    header {
      text-align: center;
      margin-bottom: 25px;
    }

    h2 {
      margin: 0;
      font-size: 24px;
      color: var(--text-main);
      font-weight: 800;
      letter-spacing: -0.5px;
    }

    .subtitle {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 5px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
      color: var(--text-main);
      opacity: 0.9;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Grid for Dates */
    .date-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    @media (max-width: 480px) {
      .date-row {
        grid-template-columns: 1fr;
      }
    }

    /* Unified Input Styles */
    select, 
    input[type="date"], 
    input[type="text"], 
    input[type="email"], 
    input[type="tel"] {
      width: 100%;
      padding: 12px 15px;
      font-size: 16px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      background-color: var(--card-bg);
      transition: var(--transition);
      appearance: none;
      -webkit-appearance: none;
      color: var(--text-main);
    }

    /* Custom Arrow for Select */
    .select-wrapper {
      position: relative;
    }
    .select-wrapper::after {
      content: "â–¼";
      font-size: 10px;
      color: var(--text-muted);
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
    }
    
    input.invalid {
        border-color: var(--danger-color);
    }

    /* Quick Date Chips */
    .quick-dates {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    
    .chip {
      background: var(--bg-color);
      border: 1px solid var(--border-color);
      color: var(--text-muted);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      user-select: none;
    }

    .chip:hover {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .chip:active {
      transform: scale(0.95);
    }

    /* Action Buttons */
    .btn-group {
      display: grid;
      gap: 10px;
      margin-top: 15px;
    }
    
    .btn-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }

    button.btn-main {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      background-color: var(--primary-color);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }

    button.btn-main:hover {
      background-color: var(--primary-hover);
      transform: translateY(-1px);
    }
    
    button.btn-main:disabled {
        background-color: var(--border-color);
        cursor: not-allowed;
        transform: none;
        opacity: 0.7;
        color: var(--text-muted);
    }

    button.btn-main:active {
      transform: translateY(1px);
    }

    .btn-whatsapp {
      background-color: var(--whatsapp-color);
    }
    .btn-whatsapp:hover {
      background-color: var(--whatsapp-hover);
    }

    .btn-copy {
      background-color: var(--bg-color);
      color: var(--text-main);
      border: 1px solid var(--border-color);
    }
    .btn-copy:hover {
      background-color: var(--border-color);
      transform: translateY(-1px);
    }
    
    .btn-link {
      background-color: var(--bg-color);
      color: var(--text-muted);
      border: 1px dashed var(--border-color);
      font-size: 14px;
    }
    .btn-link:hover {
        background-color: var(--border-color);
        color: var(--text-main);
    }

    /* Result Section */
    #result {
      margin-top: 30px;
      border-top: 2px dashed var(--border-color);
      padding-top: 20px;
      display: none;
      animation: fadeIn 0.4s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .result-days {
      font-weight: 600;
      color: var(--text-main);
      font-size: 16px;
    }

    .price-tag {
      font-size: 32px;
      font-weight: 800;
      color: var(--primary-color);
      letter-spacing: -1px;
    }

    .info-card {
      background: var(--bg-color);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 12px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
      border: 1px solid var(--border-color);
    }

    .info-icon {
      font-size: 20px;
      padding-top: 2px;
    }

    .info-content {
      flex: 1;
    }
    
    .info-title {
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: 4px;
      font-size: 14px;
    }

    .info-desc {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    /* Breakdown Toggle */
    .breakdown-section {
      margin: 15px 0;
    }
    
    .breakdown-toggle {
      font-size: 13px;
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 8px 0;
    }
    .breakdown-toggle:hover {
      color: var(--primary-color);
    }
    
    .breakdown-list {
      display: none;
      background: var(--bg-color);
      border-radius: 8px;
      padding: 10px;
      margin-top: 5px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .breakdown-list.open {
      display: block;
    }

    .breakdown-item {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      padding: 6px 0;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-main);
    }
    .breakdown-item:last-child {
      border-bottom: none;
    }
    .badge {
      font-size: 10px;
      background: var(--border-color);
      color: var(--text-muted);
      padding: 2px 6px;
      border-radius: 4px;
      margin-left: 5px;
      text-transform: uppercase;
    }
    
    .badge.holiday {
        background: #fee2e2;
        color: #dc2626;
    }

    .error-msg {
      color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      text-align: center;
      border: 1px solid rgba(239, 68, 68, 0.2);
      margin-top: 10px;
    }

    /* Toast Notification */
    .toast {
      visibility: hidden;
      min-width: 200px;
      margin-left: -100px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 50px;
      padding: 12px 20px;
      position: fixed;
      z-index: 1000;
      left: 50%;
      bottom: 30px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      opacity: 0;
      transition: opacity 0.3s, bottom 0.3s ease-in-out;
    }

    .toast.show {
      visibility: visible;
      opacity: 1;
      bottom: 50px;
    }
    
    .toast.success { background-color: var(--success-color); }
    .toast.error { background-color: var(--danger-color); }

    .section-label {
      font-size: 13px;
      font-weight: 600;
      margin: 25px 0 15px;
      color: var(--text-main);
      opacity: 0.9;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 5px;
    }

    /* Checkbox Styles */
    .checkbox-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 5px; /* Reduced to sit closer to hint */
        cursor: pointer;
        position: relative;
    }
    .checkbox-wrapper input {
        width: 18px;
        height: 18px;
        margin: 0; /* Align fix */
        flex-shrink: 0;
    }
    
    /* Disabled Checkbox Styles */
    .checkbox-wrapper input:disabled {
        cursor: not-allowed;
        opacity: 0.6;
    }
    .checkbox-wrapper input:disabled + .checkbox-text, 
    .checkbox-wrapper input:disabled + div .checkbox-text {
        color: var(--text-muted);
        cursor: not-allowed;
    }
    
    .checkbox-text {
        font-size: 14px;
        color: var(--text-main);
        line-height: 1.4;
        display: block;
    }
    .checkbox-subtext {
        font-size: 12px;
        color: var(--text-muted);
        display: block;
        margin-top: 2px;
    }

    /* FAQ Section */
    .faq-container {
        margin-top: 40px;
        border-top: 1px solid var(--border-color);
        padding-top: 20px;
    }
    .faq-title {
        font-size: 16px;
        font-weight: 700;
        margin-bottom: 15px;
        color: var(--text-main);
        text-align: center;
    }
    details {
        margin-bottom: 10px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background: var(--bg-color);
    }
    summary {
        padding: 12px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        outline: none;
        list-style: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    summary::after {
        content: '+';
        font-size: 16px;
    }
    details[open] summary::after {
        content: '-';
    }
    .faq-content {
        padding: 0 12px 12px;
        font-size: 13px;
        line-height: 1.5;
        color: var(--text-muted);
        border-top: 1px dashed var(--border-color);
        margin-top: 5px;
        padding-top: 10px;
    }

    /* Sticky Bottom Bar for Mobile */
    .sticky-total {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: var(--card-bg);
        border-top: 1px solid var(--border-color);
        padding: 15px 20px;
        box-shadow: 0 -4px 10px rgba(0,0,0,0.05);
        display: none; /* Shown via JS if needed or Media Query */
        z-index: 900;
        justify-content: space-between;
        align-items: center;
    }
    @media (max-width: 600px) {
        .sticky-total.visible {
            display: flex;
        }
    }

    /* Modal Styles */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(2px);
    }
    .modal-overlay.show {
        display: flex;
    }
    .modal-content {
        background: var(--card-bg);
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        border-radius: 12px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    .modal-header {
        padding: 15px 20px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .modal-header h3 {
        margin: 0;
        font-size: 18px;
        color: var(--text-main);
    }
    .close-modal {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-muted);
        padding: 0;
        line-height: 1;
    }
    .modal-body {
        padding: 20px;
        overflow-y: auto;
        font-size: 14px;
        line-height: 1.6;
        color: var(--text-main);
        position: relative;
    }
    .modal-body ul {
        padding-left: 20px;
        margin: 10px 0;
    }
    .modal-body li {
        margin-bottom: 8px;
    }
    
    /* Scroll Hint Bar in Modal */
    .scroll-hint {
        background: #f3f4f6;
        color: var(--text-muted);
        text-align: center;
        padding: 12px;
        font-size: 13px;
        font-weight: 600;
        border-top: 1px solid var(--border-color);
        position: sticky;
        bottom: 0;
        margin: 0 -20px -20px -20px; /* Offset parent padding */
        transition: background-color 0.3s;
    }
    .scroll-hint.done {
        background: var(--success-color);
        color: white;
    }

    /* Print Styles */
    @media print {
        body { background: white; padding: 0; color: black; }
        .container { box-shadow: none; border: none; max-width: 100%; margin: 0; padding: 0; }
        .theme-toggle, .reset-btn, .btn-group, .sticky-total, .faq-container { display: none !important; }
        input, select { border: none; background: none; padding: 0; font-weight: bold; -webkit-appearance: none; }
        .select-wrapper::after { display: none; }
        #result { display: block !important; border-top: 2px solid #000; }
        .price-tag { color: #000; }
        .info-card { border: 1px solid #ccc; }
    }

  </style>
</head>
<body>

  <div class="container">
    <button class="reset-btn" onclick="resetForm()" title="é‡ç½®è¡¨æ ¼">
      â†» é‡ç½®
    </button>
    
    <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ›æ·±è‰²æ¨¡å¼">
      <span id="theme-icon">ğŸŒ™</span>
    </button>

    <header>
      <h2>ğŸ“· 852Camera</h2>
      <div class="subtitle">å°ˆæ¥­æ”å½±å™¨æç§Ÿè³ƒè¨ˆç®—</div>
    </header>

    <div class="form-group">
      <label for="product">é¸æ“‡å™¨æå‹è™Ÿ</label>
      <div class="select-wrapper">
        <select id="product" onchange="calculatePrice()">
          <option value="">-- è«‹é¸æ“‡ --</option>
          <optgroup label="Samsung æ‰‹æ©Ÿ">
            <option value="S24U">Samsung S24U</option>
            <option value="S25U">Samsung S25U</option>
          </optgroup>
          <optgroup label="Vivo æ‰‹æ©Ÿ">
            <option value="X200 Ultra">Vivo X200 Ultra + å°ˆæ¥­æ”å½±å¥—è£</option>
            <option value="X300 Pro">Vivo X300 Pro + å°ˆæ¥­æ”å½±å¥—è£</option>
          </optgroup>
          <optgroup label="Canon ç›¸æ©Ÿ">
            <option value="R5">Canon R5</option>
            <option value="R5ii">Canon R5ii</option>
            <option value="R6ii">Canon R6ii</option>
            <option value="R6iii">Canon R6iii</option>
          </optgroup>
          <optgroup label="Canon é¡é ­">
            <option value="EF 70-200 F2.8 ii">EF 70-200 F2.8 ii</option>
            <option value="RF 70-200 F2.8">RF 70-200 F2.8</option>
            <option value="RF 100-500">RF 100-500</option>
            <option value="RF 100-400">RF 100-400</option>
            <option value="RF 50mm 1.8">RF 50mm 1.8</option>
          </optgroup>
          <optgroup label="Sony ç›¸æ©Ÿ">
            <option value="A7R5">Sony A7R5</option>
            <option value="A7C2">Sony A7C2</option>
          </optgroup>
          <optgroup label="Sony é¡é ­/é…ä»¶">
            <option value="FE 100-400">FE 100-400</option>
            <option value="FE 70-200 F2.8 ii">FE 70-200 F2.8 ii</option>
            <option value="FE 200-600">FE 200-600</option>
            <option value="1.4x Extender">1.4x é æ”å¢è·é¡</option>
          </optgroup>
          <optgroup label="Fujifilm">
            <option value="X100VI">Fujifilm X100VI</option>
          </optgroup>
        </select>
      </div>
    </div>

    <div class="date-row">
      <div class="form-group">
        <label for="startDate">å–æ©Ÿæ—¥æœŸ</label>
        <input type="date" id="startDate" onchange="handleStartDateChange()" />
      </div>
      <div class="form-group">
        <label for="endDate">é‚„æ©Ÿæ—¥æœŸ</label>
        <input type="date" id="endDate" onchange="calculatePrice()" />
        
        <!-- Quick Select Buttons -->
        <div class="quick-dates" id="quickDates" style="display:none;">
          <div class="chip" onclick="setQuickDate(1)">+1æ—¥</div>
          <div class="chip" onclick="setQuickDate(3)">+3æ—¥</div>
          <div class="chip" onclick="setQuickDate(5)">+5æ—¥</div>
          <div class="chip" onclick="setQuickDate(7)">+7æ—¥</div>
        </div>
      </div>
    </div>

    <!-- Customer Info -->
    <div class="section-label">
        <span>ğŸ‘¤ ç§Ÿç”¨è€…è³‡æ–™</span>
        <span style="font-size: 11px; color: var(--text-muted); font-weight: normal;">(å¯ç•™ç©ºæŸ¥è©¢ï¼Œå¡«å¯«å¯åŠ é€Ÿé ç´„)</span>
    </div>
    <div class="form-group">
      <label>å§“å</label>
      <input type="text" id="customerName" placeholder="è¼¸å…¥æ‚¨çš„ç¨±å‘¼" oninput="calculatePrice()">
    </div>
    <div class="form-group">
      <label>é›»éƒµ</label>
      <input type="email" id="customerEmail" placeholder="example@email.com" oninput="calculatePrice()">
      <div id="emailError" style="display:none; color: var(--danger-color); font-size: 12px; margin-top: 5px;">âš ï¸ è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»éƒµæ ¼å¼</div>
    </div>
    <div class="form-group">
      <label>å–æ©Ÿäººé›»è©±è™Ÿç¢¼</label>
      <input type="tel" id="customerPhone" placeholder="8ä½æ•¸å­—é›»è©±è™Ÿç¢¼" maxlength="8" oninput="this.value = this.value.replace(/\D/g,''); calculatePrice()">
      <div id="phoneError" style="display:none; color: var(--danger-color); font-size: 12px; margin-top: 5px;">âš ï¸ è«‹è¼¸å…¥æœ‰æ•ˆçš„8ä½æ•¸å­—é›»è©±è™Ÿç¢¼</div>
    </div>
    <div class="form-group">
      <label>ä»˜æ¬¾æ–¹å¼</label>
      <div class="select-wrapper">
        <select id="paymentMethod" onchange="calculatePrice()">
          <option value="">-- è«‹é¸æ“‡ --</option>
          <option value="FPS">FPS è½‰æ•¸å¿«</option>
          <option value="Alipay">AlipayHK</option>
          <option value="Credit Card">ä¿¡ç”¨å¡ (Credit Card)</option>
        </select>
      </div>
    </div>

    <!-- Optional Services -->
    <div class="section-label">âš™ï¸ é¡å¤–æœå‹™ (Optional)</div>
    <label class="checkbox-wrapper" style="align-items: flex-start;">
        <input type="checkbox" id="photoEditToggle" onchange="calculatePrice()">
        <div>
            <span class="checkbox-text">âœ¨ è©¦ç”¨ä¿®åœ–æœå‹™ (Photo Editing)</span>
            <span class="checkbox-subtext" style="color:var(--text-muted);">å…è²»è©¦ç”¨ (æœ€å¤š5å¼µ)ã€‚æ­¤ä¹ƒæ¸¬è©¦åŠŸèƒ½ï¼Œä¸åŒ…å«åœ¨ç§Ÿè³ƒè²»ç”¨/æœå‹™ç¯„åœå…§ã€‚</span>
        </div>
    </label>

    <!-- Error container -->
    <div id="error-box"></div>

    <div id="result">
      <!-- Results injected here -->
    </div>
    
    <!-- Terms Checkbox (Only visible when result is shown) -->
    <div id="termsContainer" style="display:none; margin-top: 15px; border-top: 1px solid var(--border-color); padding-top: 15px;">
        <label class="checkbox-wrapper" style="margin-bottom: 5px;">
            <input type="checkbox" id="termsCheck" disabled onchange="toggleButtons()">
            <span class="checkbox-text" style="font-size: 13px;">æœ¬äººå·²é–±è®€ä¸¦åŒæ„ <a href="javascript:void(0)" onclick="openTermsModal(event)" style="color:var(--primary-color); text-decoration:underline; font-weight:bold;">ç§Ÿè³ƒæ¢æ¬¾åŠç´°å‰‡</a>ï¼Œä¸¦ç¢ºèªä»¥ä¸Šè³‡æ–™æ­£ç¢ºç„¡èª¤ã€‚</span>
        </label>
        <div id="termsLockHint" style="font-size: 12px; color: var(--danger-color); margin-left: 28px;">
            âš ï¸ éœ€é»æ“Šé€£çµä¸¦é–±è®€è‡³åº•éƒ¨æ–¹å¯å‹¾é¸
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="btn-group" id="actionButtons" style="display:none; margin-top: 20px;">
        <button id="btnWhatsapp" class="btn-main btn-whatsapp" disabled onclick="sendWhatsapp()">
          <span>ğŸ’¬</span> WhatsApp é ç´„
        </button>
        
        <div class="btn-row">
          <button id="btnCopy" class="btn-main btn-copy" disabled onclick="copyQuote()">
              <span>ğŸ“‹</span> è¤‡è£½å…§å®¹
          </button>
          <button class="btn-main btn-link" onclick="copyPageUrl(this)">
              <span>ğŸ”—</span> è¤‡è£½é€£çµ
          </button>
        </div>
    </div>

    <!-- FAQ Section -->
    <div class="faq-container">
        <div class="faq-title">â“ å¸¸è¦‹å•é¡Œ (FAQ)</div>
        <details>
            <summary>å¦‚ä½•è¨ˆç®—ç§Ÿå€Ÿå¤©æ•¸ï¼Ÿ</summary>
            <div class="faq-content">å–æ©Ÿæ—¥ç•¶å¤©ä¸è¨ˆç®—ç§Ÿé‡‘ã€‚ä¾‹å¦‚ï¼š1è™Ÿå–æ©Ÿï¼Œ3è™Ÿé‚„æ©Ÿï¼Œç§ŸæœŸç‚º2å¤©ã€‚</div>
        </details>
        <details>
            <summary>æŒ‰é‡‘ä½•æ™‚é€€é‚„ï¼Ÿ</summary>
            <div class="faq-content">æª¢æŸ¥å™¨æç„¡èª¤å¾Œï¼Œç¾é‡‘/FPSæŒ‰é‡‘æœƒå³æ—¥/+1æ—¥é€€é‚„ã€‚ä¿¡ç”¨å¡é æˆæ¬Šæ–¼ä»˜æ¬¾å¾Œ7å€‹å·¥ä½œå¤©è§£é™¤é–å®šã€‚</div>
        </details>
        <details>
            <summary>å¦‚æœé²é‚„æœƒæ€æ¨£ï¼Ÿ</summary>
            <div class="faq-content">é²é‚„å°‡æ”¶å–é¡å¤–æ—¥ç§ŸåŠé€¾æœŸè¡Œæ”¿è²»ã€‚è«‹å‹™å¿…æº–æ™‚æ­¸é‚„ä»¥å…å½±éŸ¿ä¸‹ä¸€ä½å®¢äººã€‚</div>
        </details>
    </div>

  </div>
  
  <!-- Sticky Total for Mobile -->
  <div id="stickyTotal" class="sticky-total">
      <div style="font-weight:bold; font-size:16px;">ç¸½åƒ¹: <span id="stickyPrice" style="color:var(--primary-color)">$0</span></div>
      <button class="btn-main" style="width: auto; padding: 8px 16px; font-size: 14px;" onclick="document.getElementById('actionButtons').scrollIntoView({behavior: 'smooth'})">
          å‰å¾€é ç´„
      </button>
  </div>
  
  <!-- Toast Element -->
  <div id="toast" class="toast">è¨Šæ¯æç¤º</div>

  <!-- Terms Modal -->
  <div id="termsModal" class="modal-overlay" onclick="closeTermsModal(event)">
      <div class="modal-content">
          <div class="modal-header">
              <h3>ç§Ÿè³ƒæ¢æ¬¾åŠç´°å‰‡</h3>
              <button class="close-modal" onclick="closeTermsModal(event)">Ã—</button>
          </div>
          <div class="modal-body" id="modalTermsBody" onscroll="checkTermsScroll()">
              <h4 style="margin-top:0;">ğŸ“œ ç§Ÿè³ƒæ¢æ¬¾</h4>
              <ul>
                  <li>å¦‚ç§Ÿå€ŸæœŸé–“éºå¤±/æå£ä»»ä½•å™¨ææˆ–é…ä»¶ï¼Œæ‰¿ç§Ÿäººé ˆæ ¹æ“šæœ¬å…¬å¸æ‰€åˆ—ä¹‹åƒ¹ç›®è¡¨ä½œå‡ºè³ å„Ÿã€‚</li>
                  <li>å¦‚å™¨ææˆ–é…ä»¶å‡ºç¾æ•…éšœï¼Œæ‰¿ç§Ÿäººéœ€æ‰¿æ“”ç›¸é—œç¶­ä¿®è²»ç”¨ï¼›æœ¬å…¬å¸æœ‰æ¬Šæš«æ™‚ä¿ç•™æŒ‰é‡‘ï¼Œç›´è‡³å®Œæˆç¶­ä¿®ç¨‹åºã€‚ ç›¸é—œç¶­ä¿®æ¬¾é …å°‡æ–¼æŒ‰é‡‘ä¸­æ‰£é™¤ã€‚</li>
                  <li>è‹¥äº¤æ”¶æ™‚æœªèƒ½æä¾›æ‰€éœ€æŒ‰é‡‘ï¼Œäº¤æ˜“å°‡è¢«å–æ¶ˆï¼Œå·²ç¹³ä»˜ä¹‹è²»ç”¨å°‡ä¸äºˆé€€é‚„ã€‚</li>
                  <li>ä»¥ä¿¡ç”¨å¡ç¹³ä»˜æŒ‰é‡‘æ¶‰åŠä¿¡ç”¨å¡æˆæ¬Šé ç•™é¡åº¦ï¼Œè©²é ç•™åƒ…ä½œä¿è­‰ç”¨é€”ï¼Œä¸¦ä¸æ§‹æˆå¯¦éš›äº¤æ˜“ã€‚æ­¸é‚„å™¨æä¸”é©—æ”¶ç„¡èª¤å¾Œï¼Œé ç•™å°‡è¢«å–æ¶ˆã€‚</li>
                  <li>å­¸ç”ŸæŒ‰é‡‘è¨ˆåŠƒæ‰€é™„ä¹‹æ´»å‹•é–€ç¥¨ï¼Œå…¶æ´»å‹•æ—¥æœŸå¿…é ˆå®‰æ’æ–¼ç§Ÿå€ŸæœŸé–“å…§ï¼Œå¦å‰‡è¦–ç‚ºç„¡æ•ˆã€‚</li>
                  <li>æ­¸é‚„å™¨ææ™‚ï¼Œè¨­å‚™é›»é‡é ˆé”80%æˆ–ä»¥ä¸Šã€‚å¦‚ç„¡æ³•é”æ¨™ï¼Œå°‡æ”¶å–æ¸¯å¹£$10ä¹‹æœå‹™è²»ã€‚</li>
                  <li>é‚„æ©Ÿå‰è«‹è‡ªè¡Œå°‡è¨˜æ†¶å¡æ ¼å¼åŒ–ã€‚å¦‚æœªæ ¼å¼åŒ–ï¼Œå¯èƒ½å½±éŸ¿å¾ŒçºŒä½¿ç”¨ï¼Œæ‰¿ç§Ÿäººéœ€æ‰¿æ“”ç›¸é—œè²¬ä»»ã€‚</li>
                  <li>å–æ©Ÿæ™‚è«‹ä»”ç´°æª¢æŸ¥å™¨æç‹€æ…‹ï¼Œå¦‚ç™¼ç¾ä»»ä½•æå£æˆ–ç•°å¸¸ï¼Œè«‹å³æ™‚é€éWhatsAppæˆ–Instagramç§è¨Šä¸¦æä¾›ç…§ç‰‡å‚™æ¡ˆã€‚å¦å‰‡å°‡è¦–ç‚ºäº¤æ”¶æ™‚å™¨æç‹€æ³è‰¯å¥½ã€‚</li>
                  <li>æ‰€æä¾›ä¹‹è¨˜æ†¶å¡åƒ…ç‚ºæ–¹ä¾¿é¡§å®¢å­˜å–åŠå‚³è¼¸æª”æ¡ˆä¹‹ç”¨ã€‚å¦‚è¨˜æ†¶å¡ç™¼ç”Ÿæ•…éšœå°è‡´æª”æ¡ˆæå¤±æˆ–ç„¡æ³•è®€å–ï¼Œæœ¬å…¬å¸æ¦‚ä¸è² è²¬ã€‚</li>
                  <li>å¦‚è¨˜æ†¶å¡å‡ºç¾è®€å–å•é¡Œï¼Œè«‹å‹¿æ“…è‡ªäº¤ç”±ç¬¬ä¸‰æ–¹é€²è¡Œæ•¸æ“šä¿®å¾©æˆ–ç¶­ä¿®ã€‚å¦å‰‡è¦–åŒæå£è¨˜æ†¶å¡ï¼Œæ‰¿ç§Ÿäººéœ€æŒ‰åŸåƒ¹ä½œå‡ºè³ å„Ÿã€‚</li>
                  <li>ä»˜æ¬¾å¾Œé ç´„ä¸€ç¶“ç¢ºèªæ•ä¸ä½œé€€æ¬¾</li>
              </ul>

              <h4>ğŸ› ï¸ å™¨ææå£ï¼éºå¤±è³ å„Ÿåƒ¹ç›®è¡¨</h4>
              <ul>
                  <li>åˆ®èŠ± HKD$200+/æ¯æ¢</li>
                  <li>æ’å‡¹ HKD$500+/æ¯æ¢</li>
                  <li>æ©Ÿèº«è“‹/é¡é ­è“‹ï¼šHKD$200</li>
                  <li>é›»æ± ï¼šHKD$700</li>
                  <li>å……é›»å™¨ï¼šHKD$500</li>
                  <li>ç›¸æ©Ÿè¢‹ï¼šHKD$100</li>
                  <li>è¨˜æ†¶å¡: HKD$220(128GB) / $400(256GB) / $1000(CFB)</li>
              </ul>

              <h4>ğŸ’³ æŒ‰é‡‘ç¹³ä»˜æ–¹å¼</h4>
              <div style="background:#f9f9f9; padding:10px; border-radius:8px; margin-bottom:10px; font-size:13px;">
                  è«‹å‰å¾€ 852.camera ç¶²åº—ï¼š<br>
                  ğŸ‘‰ <a href="https://o852camerarental.booking-radar.com" target="_blank" style="color:var(--primary-color);">https://o852camerarental.booking-radar.com</a><br>
                  é»é¸ ã€ŒæŒ‰é‡‘ã€ åˆ†é¡ï¼Œé¸æ“‡ç›¸æ‡‰å™¨æï¼Œä»»é¸ä¸€å¤©é€²è¡Œä»˜æ¬¾ã€‚
              </div>

              <strong>1. ä¿¡ç”¨å¡é æˆæ¬Šï¼ˆHold Limitï¼‰</strong>
              <p style="margin:5px 0;">è«‹é¸æ“‡ä»¥ä¸‹å…¶ä¸­ä¸€ç¨®æ–¹å¼ä»˜æ¬¾ï¼šä¿¡ç”¨å¡ / Apple Pay / Google Pay</p>
              <p style="font-size:12px; color:#666; margin-bottom:10px;">
                  ğŸ“Œ æ³¨æ„äº‹é …ï¼šå¦‚ç§Ÿå€ŸæœŸè¶…é 7 æ—¥ï¼Œå°‡æ”¶å– 4% è™•ç†è²»ï¼Œè©²è²»ç”¨å°‡ç›´æ¥ç”±æŒ‰é‡‘ä¸­æ‰£é™¤ã€‚<br>
                  å»ºè­°æ–¼å–æ©Ÿå‰å®Œæˆä»˜æ¬¾ï¼Œä»¥å…å› ç³»çµ±å»¶èª¤æœªèƒ½å³æ™‚æ”¶åˆ°ç¢ºèªé›»éƒµã€‚
              </p>

              <strong>2. FPS / éŠ€è¡Œè½‰å¸³</strong>
              <p style="margin:5px 0;">è«‹é¸æ“‡ FPS æ–¹å¼å®Œæˆä»˜æ¬¾ï¼Œä¸¦ä¿ç•™äº¤æ˜“è¨˜éŒ„ä»¥ä¾›æ ¸å¯¦ã€‚</p>

              <h4>ğŸ“… å»ºè­°ä»˜æ¬¾æ™‚é–“</h4>
              <p>å»ºè­°æ–¼å–æ©Ÿå‰ä¸€æ—¥å®ŒæˆæŒ‰é‡‘ç¹³ä»˜ï¼Œä»¥å…ç•¶æ—¥å–æ©Ÿæ™‚å‡ºç¾å»¶èª¤æˆ–å•é¡Œã€‚å¦‚é¸æ“‡æ–¼äº¤æ”¶ä¸­å¿ƒç¾å ´ä»˜æ¬¾ï¼Œè«‹å‹™å¿…å‘è·å“¡å‡ºç¤ºä»˜æ¬¾è­‰æ˜ã€‚</p>

              <h4>ğŸ’¸ æŒ‰é‡‘é€€å›æ–¹å¼</h4>
              <p>å™¨ææ­¸é‚„å¾Œå¦‚ç„¡ä»»ä½•æå£æˆ–å•é¡Œï¼ŒæŒ‰é‡‘(FPS/Alipay)å°‡æ–¼å³æ—¥/ç¿Œæ—¥é€€å›ã€‚ä¿¡ç”¨å¡å°‡æ–¼ä»˜æ¬¾æ—¥+7æ—¥å¾Œè‡ªå‹•å–æ¶ˆã€‚</p>

              <h4>â— é‡è¦æé†’</h4>
              <p style="color:var(--danger-color); font-weight:bold;">
                  äº¤æ”¶ä¸­å¿ƒè·å“¡ä¸¦é 852Camera å“¡å·¥ï¼Œè«‹æ–¼é‚„æ©Ÿå¾Œç›´æ¥ WhatsApp æˆ– IG DM é€šçŸ¥æˆ‘å€‘å·²æˆåŠŸæ­¸é‚„å™¨æã€‚
              </p>

              <h4>ğŸ‘©ğŸ»â€ğŸ“ğŸ‘¨ğŸ»â€ğŸ“ å­¸ç”ŸæŒ‰é‡‘è¨ˆåŠƒ</h4>
              <p>å¦‚æ¬²é¸ç”¨å­¸ç”ŸæŒ‰é‡‘æ–¹æ¡ˆï¼Œè«‹æ–¼ <u>å–æ©Ÿå‰æœ€å°‘ä¸€å¤©</u> æäº¤ä»¥ä¸‹è³‡æ–™è‡³æˆ‘å€‘çš„ WhatsApp æˆ– IGï¼š</p>
              <ul style="margin-bottom:5px;">
                  <li>èº«ä»½è­‰å‰¯æœ¬</li>
                  <li>æœ‰æ•ˆå­¸ç”Ÿè­‰å‰¯æœ¬</li>
                  <li>æ´»å‹•é–€ç¥¨ï¼ˆæ´»å‹•å¿…é ˆæ–¼ç§Ÿå€ŸæœŸé–“èˆ‰è¡Œï¼‰</li>
              </ul>
              <p style="font-size:13px; color:var(--success-hover);">âœ… å»ºè­°æ–¼å­¸ç”Ÿè­‰åŠèº«ä»½è­‰ä¸ŠåŠ ä¸Šæ°´å°ï¼Œè¨»æ˜ã€Œåƒ…ä¾› 852Camera å™¨æç§Ÿç”¨ç”¨é€”ã€ã€‚</p>
              <p style="font-size:12px; color:#666;">ğŸ“Œ å¦‚æœªèƒ½æå‰æäº¤ä¸Šè¿°è³‡æ–™ï¼Œå°‡è¦–ç‚ºæ”¾æ£„å­¸ç”ŸæŒ‰é‡‘è¨ˆåŠƒï¼Œéœ€æŒ‰ä¸€èˆ¬æŒ‰é‡‘æ–¹å¼è™•ç†ã€‚</p>

              <h4>ğŸ¤ å¦‚éœ€ç”±ä»–äººä»£å–å™¨æ</h4>
              <p>è«‹æå‰é€šçŸ¥æˆ‘å€‘ï¼Œå¦å‰‡ç³»çµ±å°‡è‡ªå‹•ç™»è¨˜æ‚¨æœ¬äººé›»è©±è™Ÿç¢¼ç‚ºå–æ©Ÿäººã€‚</p>
              
              <!-- Scroll Hint Inside Body -->
              <div id="scrollHint" class="scroll-hint">è«‹å‘ä¸‹æ²å‹•ä»¥é–±è®€å®Œæ•´æ¢æ¬¾ â¬‡ï¸</div>
          </div>
      </div>
  </div>

  <script>
    const WHATSAPP_PHONE = "85257409553"; 
    
    const publicHolidays = [
        "2024-12-25", "2024-12-26", "2025-01-01", 
        "2025-01-29", "2025-01-30", "2025-01-31" 
    ];

    const pricingData = {
      "S24U": { deposit: 6000, perDay: 180, weekday1: 160, weekend: { 2: 110, 3: 50, more: 50 }, weekday: { 2: 100, 3: 50, more: 50 } },
      "S25U": { deposit: 8000, perDay: 280, weekday1: 250, weekend: { 2: 170, 3: 80, more: 70 }, weekday: { 2: 150, 3: 70, more: 60 } },
      "X200 Ultra": { deposit: 9000, perDay: 280, weekday1: 250, weekend: { 2: 170, 3: 80, more: 70 }, weekday: { 2: 150, 3: 70, more: 60 } },
      "X300 Pro": { deposit: 9000, perDay: 280, weekday1: 250, weekend: { 2: 170, 3: 80, more: 70 }, weekday: { 2: 150, 3: 70, more: 60 } },
      "R5": { deposit: 16000, perDay: 350, weekday1: 320, weekend: { 2: 210, 3: 110, more: 90 }, weekday: { 2: 190, 3: 100, more: 80 } },
      "R5ii": { deposit: 20000, perDay: 500, weekday1: 450, weekend: { 2: 300, 3: 150, more: 130 }, weekday: { 2: 270, 3: 140, more: 120 } },
      "R6ii": { deposit: 12000, perDay: 300, weekday1: 270, weekend: { 2: 180, 3: 90, more: 80 }, weekday: { 2: 160, 3: 80, more: 70 } },
      "R6iii": { deposit: 18000, perDay: 400, weekday1: 360, weekend: { 2: 240, 3: 120, more: 100 }, weekday: { 2: 220, 3: 110, more: 90 } },
      "EF 70-200 F2.8 ii": { deposit: 8000, perDay: 190, weekday1: 170, weekend: { 2: 110, 3: 60, more: 50 }, weekday: { 2: 100, 3: 50, more: 50 } },
      "RF 70-200 F2.8": { deposit: 14000, perDay: 400, weekday1: 360, weekend: { 2: 240, 3: 120, more: 100 }, weekday: { 2: 220, 3: 110, more: 90 } },
      "RF 100-500": { deposit: 15000, perDay: 400, weekday1: 360, weekend: { 2: 240, 3: 120, more: 100 }, weekday: { 2: 220, 3: 110, more: 90 } },
      "RF 100-400": { deposit: 3000, perDay: 120, weekday1: 110, weekend: { 2: 70, 3: 40, more: 30 }, weekday: { 2: 60, 3: 40, more: 30 } },
      "RF 50mm 1.8": { deposit: 1000, perDay: 50, weekday1: 50, weekend: { 2: 30, 3: 20, more: 10 }, weekday: { 2: 30, 3: 20, more: 10 } },
      "A7R5": { deposit: 18000, perDay: 400, weekday1: 360, weekend: { 2: 240, 3: 120, more: 100 }, weekday: { 2: 220, 3: 110, more: 90 } },
      "A7C2": { deposit: 12000, perDay: 350, weekday1: 320, weekend: { 2: 210, 3: 110, more: 90 }, weekday: { 2: 190, 3: 100, more: 80 } },
      "FE 100-400": { deposit: 12000, perDay: 290, weekday1: 260, weekend: { 2: 170, 3: 90, more: 70 }, weekday: { 2: 150, 3: 80, more: 60 } },
      "FE 70-200 F2.8 ii": { deposit: 13000, perDay: 400, weekday1: 360, weekend: { 2: 240, 3: 120, more: 100 }, weekday: { 2: 220, 3: 110, more: 90 } },
      "FE 200-600": { deposit: 8000, perDay: 230, weekday1: 210, weekend: { 2: 140, 3: 70, more: 60 }, weekday: { 2: 130, 3: 60, more: 50 } },
      "1.4x Extender": { deposit: 2000, perDay: 80, weekday1: 70, weekend: { 2: 50, 3: 20, more: 20 }, weekday: { 2: 50, 3: 20, more: 20 } },
      "X100VI": { deposit: 14000, perDay: 350, weekday1: 320, weekend: { 2: 210, 3: 110, more: 90 }, weekday: { 2: 190, 3: 100, more: 80 } }
    };

    // DOM Elements
    const elements = {
        product: document.getElementById("product"),
        start: document.getElementById("startDate"),
        end: document.getElementById("endDate"),
        name: document.getElementById("customerName"),
        email: document.getElementById("customerEmail"),
        phone: document.getElementById("customerPhone"),
        payment: document.getElementById("paymentMethod"),
        photoEdit: document.getElementById("photoEditToggle"),
        result: document.getElementById("result"),
        errorBox: document.getElementById("error-box"),
        quickDates: document.getElementById("quickDates"),
        emailError: document.getElementById("emailError"),
        phoneError: document.getElementById("phoneError"),
        termsContainer: document.getElementById("termsContainer"),
        termsCheck: document.getElementById("termsCheck"),
        termsLockHint: document.getElementById("termsLockHint"),
        btns: document.getElementById("actionButtons"),
        btnWhatsapp: document.getElementById("btnWhatsapp"),
        btnCopy: document.getElementById("btnCopy"),
        stickyTotal: document.getElementById("stickyTotal"),
        stickyPrice: document.getElementById("stickyPrice"),
        termsModal: document.getElementById("termsModal")
    };

    // State
    let currentQuoteText = "";

    // Init
    const today = new Date().toISOString().split("T")[0];
    elements.start.min = today;
    elements.end.min = today;

    // Load from LocalStorage on mount
    window.addEventListener('DOMContentLoaded', () => {
        loadFromLocal(); // 1. Load local data
        
        // 2. Override with URL params if exist
        const params = new URLSearchParams(window.location.search);
        if (params.has('product')) elements.product.value = params.get('product');
        if (params.has('start')) elements.start.value = params.get('start');
        if (params.has('end')) elements.end.value = params.get('end');
        
        if (elements.start.value) handleStartDateChange();
        if (elements.product.value && elements.start.value && elements.end.value) calculatePrice();
    });

    // Save to LocalStorage helper
    function saveToLocal() {
        const data = {
            product: elements.product.value,
            start: elements.start.value,
            end: elements.end.value,
            name: elements.name.value,
            email: elements.email.value,
            phone: elements.phone.value,
            payment: elements.payment.value
        };
        localStorage.setItem('rentalCalculatorData', JSON.stringify(data));
    }

    function loadFromLocal() {
        const stored = localStorage.getItem('rentalCalculatorData');
        if (stored) {
            try {
                const data = JSON.parse(stored);
                if (data.product) elements.product.value = data.product;
                if (data.start) elements.start.value = data.start;
                if (data.end) elements.end.value = data.end;
                if (data.name) elements.name.value = data.name;
                if (data.email) elements.email.value = data.email;
                if (data.phone) elements.phone.value = data.phone;
                if (data.payment) elements.payment.value = data.payment;
            } catch(e) {}
        }
    }

    function toggleTheme() {
      const body = document.body;
      const currentTheme = body.getAttribute("data-theme");
      const icon = document.getElementById("theme-icon");
      
      if (currentTheme === "dark") {
        body.removeAttribute("data-theme");
        icon.innerText = "ğŸŒ™";
      } else {
        body.setAttribute("data-theme", "dark");
        icon.innerText = "â˜€ï¸";
      }
    }
    
    function resetForm() {
        localStorage.removeItem('rentalCalculatorData'); // Clear storage
        elements.product.value = "";
        elements.start.value = "";
        elements.end.value = "";
        elements.name.value = "";
        elements.email.value = "";
        elements.phone.value = "";
        elements.payment.value = "";
        elements.photoEdit.checked = false;
        elements.termsCheck.checked = false;
        elements.termsCheck.disabled = true; // Reset disabled state
        
        if(elements.termsLockHint) elements.termsLockHint.style.display = 'block';
        
        const hint = document.getElementById('scrollHint');
        if(hint) {
            hint.innerText = "è«‹å‘ä¸‹æ²å‹•ä»¥é–±è®€å®Œæ•´æ¢æ¬¾ â¬‡ï¸";
            hint.classList.remove('done');
        }
        
        elements.emailError.style.display = "none";
        elements.phoneError.style.display = "none";

        elements.quickDates.style.display = "none";
        elements.result.style.display = "none";
        elements.termsContainer.style.display = "none";
        elements.btns.style.display = "none";
        elements.stickyTotal.classList.remove("visible");
        elements.errorBox.innerHTML = "";
        
        const url = new URL(window.location);
        url.search = "";
        try { window.history.replaceState({}, '', url); } catch(e) {}
    }

    function handleStartDateChange() {
      if (!elements.start.value) {
        elements.quickDates.style.display = "none";
        return;
      }
      elements.quickDates.style.display = "flex";
      elements.end.min = elements.start.value;
      if (elements.end.value && elements.end.value < elements.start.value) {
        elements.end.value = elements.start.value;
      }
      calculatePrice();
    }

    function setQuickDate(daysToAdd) {
      if (!elements.start.value) return;
      const date = new Date(elements.start.value);
      date.setDate(date.getDate() + daysToAdd);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      elements.end.value = `${year}-${month}-${day}`;
      calculatePrice();
    }

    function updateURL() {
        const url = new URL(window.location);
        url.searchParams.set('product', elements.product.value);
        url.searchParams.set('start', elements.start.value);
        url.searchParams.set('end', elements.end.value);
        try { window.history.replaceState({}, '', url); } catch(e) { }
    }

    function toggleButtons() {
        const agreed = elements.termsCheck.checked;
        elements.btnWhatsapp.disabled = !agreed;
        elements.btnCopy.disabled = !agreed;
    }

    // Modal Functions
    function openTermsModal(e) {
        if(e) e.preventDefault();
        elements.termsModal.classList.add('show');
        document.body.style.overflow = 'hidden'; // Prevent scrolling bg
        
        // Initial Check if scrolling is needed
        setTimeout(checkTermsScroll, 100);
    }

    function closeTermsModal(e) {
        if(e.target === elements.termsModal || e.target.classList.contains('close-modal')) {
            elements.termsModal.classList.remove('show');
            document.body.style.overflow = '';
        }
    }
    
    function checkTermsScroll() {
        const el = document.getElementById('modalTermsBody');
        const hint = document.getElementById('scrollHint');
        
        // Check if reached bottom with small tolerance
        if (el.scrollHeight - el.scrollTop - el.clientHeight < 20) {
            if (elements.termsCheck.disabled) {
                elements.termsCheck.disabled = false;
                if(elements.termsLockHint) elements.termsLockHint.style.display = 'none';
                hint.innerText = "âœ… å·²é–±è®€å®Œç•¢ï¼Œç¾åœ¨å¯ä»¥å‹¾é¸åŒæ„æ¢æ¬¾";
                hint.classList.add('done');
            }
        }
    }

    function calculatePrice() {
      // 1. Save state
      saveToLocal();
      updateURL();

      const product = elements.product.value;
      const startDateRaw = elements.start.value;
      const endDateRaw = elements.end.value;
      
      // 2. Reset UI
      elements.errorBox.innerHTML = "";
      elements.stickyTotal.classList.remove("visible");
      
      // 3. Validation - Email
      const emailVal = elements.email.value.trim();
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      elements.emailError.style.display = (emailVal && !emailPattern.test(emailVal)) ? 'block' : 'none';

      // Validation - Phone
      const phoneVal = elements.phone.value.trim();
      elements.phoneError.style.display = (phoneVal && phoneVal.length !== 8) ? 'block' : 'none';
      
      // Validation - Basic
      if (!product || !startDateRaw || !endDateRaw) {
        elements.result.style.display = "none";
        elements.termsContainer.style.display = "none";
        elements.btns.style.display = "none";
        return;
      }
      
      const startDate = new Date(startDateRaw);
      const endDate = new Date(endDateRaw);

      if (endDate < startDate) {
        elements.errorBox.innerHTML = '<div class="error-msg">âš ï¸ çµæŸæ—¥å¿…é ˆå¤§æ–¼æˆ–ç­‰æ–¼é–‹å§‹æ—¥</div>';
        elements.result.style.display = "none";
        elements.termsContainer.style.display = "none";
        elements.btns.style.display = "none";
        return;
      }

      // 4. Calculation Logic
      let days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
      if (days === 0) days = 1;

      const data = pricingData[product];
      let baseTotal = 0;
      let currentCalcDate = new Date(startDate);
      let breakdownHtml = "";
      
      for (let i = 1; i <= days; i++) {
        currentCalcDate.setDate(currentCalcDate.getDate() + 1);
        const dow = currentCalcDate.getDay(); 
        const dateStrISO = currentCalcDate.toISOString().split('T')[0];
        const isHoliday = publicHolidays.includes(dateStrISO);
        
        let dailyPrice = 0;
        let dayType = "å¹³æ—¥";
        let typeClass = "badge";

        if (i === 1) {
          const isDay1Weekday = (dow >= 1 && dow <= 3 && !isHoliday);
          dailyPrice = isDay1Weekday ? data.weekday1 : data.perDay;
          dayType = isDay1Weekday ? "é¦–æ—¥ (å¹³æ—¥)" : (isHoliday ? "é¦–æ—¥ (å…¬çœ¾å‡æœŸ)" : "é¦–æ—¥ (å‡æ—¥)");
          if (isHoliday) typeClass = "badge holiday";
        } else {
          const isWeekend = (dow === 0 || dow >= 4 || isHoliday);
          const tier = isWeekend ? data.weekend : data.weekday;
          if (isHoliday) { dayType = "å…¬çœ¾å‡æœŸ"; typeClass = "badge holiday"; }
          else { dayType = isWeekend ? "å‡æ—¥åƒ¹" : "å¹³æ—¥åƒ¹"; }

          if (i === 2) dailyPrice = tier[2];
          else if (i === 3) dailyPrice = tier[3];
          else dailyPrice = tier.more;
        }
        
        baseTotal += dailyPrice;
        const dateStr = `${currentCalcDate.getMonth()+1}/${currentCalcDate.getDate()}`;
        
        breakdownHtml += `
          <div class="breakdown-item">
            <div><span class="breakdown-date">${dateStr}</span><span class="${typeClass}">${dayType}</span></div>
            <span class="breakdown-price">$${dailyPrice}</span>
          </div>
        `;
      }

      let finalTotal = baseTotal;

      // 7. Update View
      const productName = elements.product.options[elements.product.selectedIndex].text;
      
      // Update Global State for Copy/WhatsApp
      currentQuoteText = `ğŸ“· ç§Ÿå€ŸæŸ¥è©¢\n------------------\n`;
      if(elements.name.value) currentQuoteText += `ğŸ‘¤ å§“å: ${elements.name.value}\n`;
      if(elements.email.value) currentQuoteText += `ğŸ“§ é›»éƒµ: ${elements.email.value}\n`;
      if(elements.phone.value) currentQuoteText += `ğŸ“ é›»è©±: ${elements.phone.value}\n`;
      if(elements.payment.value) currentQuoteText += `ğŸ’³ ä»˜æ¬¾æ–¹å¼: ${elements.payment.value}\n`;
      currentQuoteText += `------------------\n`;
      currentQuoteText += `ğŸ“¦ å™¨æ: ${productName}\nğŸ—“ï¸ æ—¥æœŸ: ${startDateRaw} è‡³ ${endDateRaw}\nâ±ï¸ å¤©æ•¸: å…± ${days} å¤©\n`;
      
      if(elements.photoEdit.checked) {
          currentQuoteText += `âœ¨ ä¿®åœ–æœå‹™: å…è²»è©¦ç”¨ (æœ€å¤š5å¼µ)\n`;
      }
      
      currentQuoteText += `ğŸ’° ç¸½åƒ¹: $${finalTotal.toLocaleString()}\nğŸ”’ æŒ‰é‡‘: $${data.deposit.toLocaleString()}`;
      currentQuoteText += `\n\nâœ… æœ¬äººå·²é–±è®€ä¸¦åŒæ„ ç§Ÿè³ƒæ¢æ¬¾åŠç´°å‰‡ï¼Œä¸¦ç¢ºèªä»¥ä¸Šè³‡æ–™æ­£ç¢ºç„¡èª¤ã€‚`;

      elements.result.innerHTML = `
        <div class="result-header">
          <div class="result-days">ğŸ“… ç§Ÿå€Ÿ ${days} å¤© <div style="font-size:12px; font-weight:normal; color:var(--text-muted); margin-top:4px;">å–æ©Ÿæ—¥ä¸è¨ˆè²»</div></div>
          <div class="price-tag">$${finalTotal.toLocaleString()}</div>
        </div>
        
        <div class="info-card">
          <div class="info-icon">ğŸ”’</div>
          <div class="info-content">
            <div class="info-title">æŒ‰é‡‘: $${data.deposit.toLocaleString()}</div>
            <div class="info-desc">æ”¯æŒä¿¡ç”¨å¡é æˆæ¬Š (Hold Limit) / FPS </div>
          </div>
        </div>

        <div class="breakdown-section">
           <div class="breakdown-toggle" onclick="toggleBreakdown()"><span>ğŸ“‹ æŸ¥çœ‹åƒ¹æ ¼è©³æƒ…</span><span>â–¼</span></div>
           <div class="breakdown-list" id="breakdownList">${breakdownHtml}</div>
        </div>

        <div class="info-card" style="border-left: 3px solid var(--primary-color);">
          <div class="info-icon">ğŸ“</div>
          <div class="info-content">
            <div class="info-title">å­¸ç”ŸæŒ‰é‡‘è¨ˆåŠƒ</div>
            <div class="info-desc">éœ€æäº¤ï¼š1. èº«ä»½è­‰å‰¯æœ¬ 2. å­¸ç”Ÿè­‰å‰¯æœ¬ 3. æ´»å‹•é–€ç¥¨ (ç§Ÿå€ŸæœŸå…§)</div>
          </div>
        </div>
      `;
      
      elements.result.style.display = "block";
      elements.termsContainer.style.display = "block";
      elements.btns.style.display = "grid";
      
      // Update Sticky Bar
      elements.stickyPrice.innerText = `$${finalTotal.toLocaleString()}`;
      elements.stickyTotal.classList.add("visible");
    }

    function toggleBreakdown() {
      const list = document.getElementById("breakdownList");
      list.classList.toggle("open");
    }

    function sendWhatsapp() {
        const url = `https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(currentQuoteText)}`;
        window.open(url, '_blank');
    }

    function copyQuote() {
        copyToClipboard(elements.btnCopy, currentQuoteText);
    }

    function showToast(message, type = 'normal') {
        const toast = document.getElementById("toast");
        toast.className = "toast show"; 
        toast.innerText = message;
        if (type === 'success') toast.classList.add("success");
        if (type === 'error') toast.classList.add("error");
        setTimeout(() => { toast.className = "toast"; }, 3000);
    }

    function copyToClipboard(btn, text) {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      textArea.style.position = "fixed";
      textArea.style.left = "-9999px";
      textArea.style.fontSize = "16px";
      textArea.setAttribute("readonly", "");
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      textArea.setSelectionRange(0, 99999);
      
      try {
        const successful = document.execCommand('copy');
        if (successful) {
            showToast("âœ… å·²è¤‡è£½å…§å®¹", "success");
            if(btn) {
                const originalHtml = btn.innerHTML;
                btn.innerHTML = "<span>âœ…</span> å·²è¤‡è£½";
                btn.style.backgroundColor = "var(--border-color)";
                setTimeout(() => { btn.innerHTML = originalHtml; btn.style.backgroundColor = ""; }, 2000);
            }
        } else {
             showToast("âŒ è¤‡è£½å¤±æ•—", "error");
        }
      } catch (err) {
        showToast("âŒ è¤‡è£½å¤±æ•—", "error");
      }
      document.body.removeChild(textArea);
    }
    
    function copyPageUrl(btn) {
        copyToClipboard(btn, window.location.href);
    }
  </script>
</body>
</html>
